/*!
 * Mvc.Grid 4.0.2
 * https://github.com/NonFactors/MVC6.Grid
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
function MvcGridExtends(n,t){function i(){this.constructor=n}Object.setPrototypeOf(n,t);n.prototype=(i.prototype=t.prototype,new i)}var MvcGrid=function(){function n(n,t){var i=this,u,r;if(t=t||{},n=i.findGrid(n),n.dataset.id)return i.instances[parseInt(n.dataset.id)].set(t);i.columns=[];i.element=n;i.loadingDelay=300;i.requestType="get";i.name=n.dataset.name;i.popup=new MvcGridPopup(i);i.filterMode=n.dataset.filterMode;i.prefix=i.name?i.name+"-":"";i.sourceUrl=i.element.dataset.sourceUrl;i.element.dataset.id=t.id||i.instances.length;i.filters={"enum":MvcGridEnumFilter,date:MvcGridDateFilter,guid:MvcGridGuidFilter,text:MvcGridTextFilter,number:MvcGridNumberFilter,boolean:MvcGridBooleanFilter};u=n.querySelectorAll(".mvc-grid-row-filters th");[].forEach.call(n.querySelectorAll(".mvc-grid-headers th"),function(n,t){i.columns.push(new MvcGridColumn(i,n,u[t]))});r=n.querySelector(".mvc-grid-pager");r&&(i.pager=new MvcGridPager(i,r));t.id?i.instances[parseInt(t.id)]=i:i.instances.push(i);i.set(t);i.cleanUp();i.bind();i.sourceUrl&&!n.children.length&&i.reload()}return n.prototype={instances:[],lang:{text:{contains:"Contains",equals:"Equals","not-equals":"Not equals","starts-with":"Starts with","ends-with":"Ends with"},number:{equals:"Equals","not-equals":"Not equals","less-than":"Less than","greater-than":"Greater than","less-than-or-equal":"Less than or equal","greater-than-or-equal":"Greater than or equal"},date:{equals:"Equals","not-equals":"Not equals","earlier-than":"Earlier than","later-than":"Later than","earlier-than-or-equal":"Earlier than or equal","later-than-or-equal":"Later than or equal"},"enum":{equals:"Equals","not-equals":"Not equals"},guid:{equals:"Equals","not-equals":"Not equals"},boolean:{equals:"Equals","not-equals":"Not equals"},filter:{apply:"&#10004;",remove:"&#10008;"},operator:{select:"",and:"and",or:"or"}},findGrid:function(n){var t=n;if(!t)throw new Error("Grid element was not specified.");while(t&&!t.classList.contains("mvc-grid"))t=t.parentElement;if(!t)throw new Error("Grid can only be created from within mvc-grid structure.");return t},set:function(n){var t=this,u=n.filters||{},r,i;for(r in u)t.filters[r]=u[r];return t.columns.forEach(function(n){n.filter&&t.filters[n.filter.name]&&(n.filter.instance=new t.filters[n.filter.name](n),n.filter.instance.init())}),t.requestType=n.requestType||t.requestType,t.sourceUrl=n.sourceUrl===undefined?t.sourceUrl:n.sourceUrl,t.loadingDelay=n.loadingDelay===undefined?t.loadingDelay:n.loadingDelay,t.sourceUrl?(i=t.sourceUrl.split("?",2),t.sourceUrl=i[0],n.query!==undefined?t.query=new MvcGridQuery(n.query):(i[1]||!t.query)&&(t.query=new MvcGridQuery(i[1]))):t.query=n.query!==undefined?new MvcGridQuery(n.query):new MvcGridQuery(window.location.search),this},reload:function(){var t=this;t.dispatchEvent("reloadstart",{grid:t});t.sourceUrl?t.startLoading(function(i){for(var r=-1,u=t.element.parentElement,f;u.children[++r]!=t.element;);if(t.element.outerHTML=i,!u.children[r].classList.contains("mvc-grid"))throw new Error("Grid partial should only include grid declaration.");f=new n(u.children[r],{loadingDelay:t.loadingDelay,requestType:t.requestType,query:t.query.toString(),id:t.element.dataset.id,sourceUrl:t.sourceUrl,filters:t.filters});f.dispatchEvent("reloadend",{grid:f})},function(n){t.dispatchEvent("reloadfail",{grid:t,result:n})}):window.location.href=window.location.origin+window.location.pathname+t.query},startLoading:function(n,t){var i=this,u=(i.query.toString()?i.query+"&":"?")+"_="+Date.now(),r;i.stopLoading();i.loadingDelay==null||i.element.querySelector(".mvc-grid-loader")||(r=document.createElement("div"),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),r.appendChild(document.createElement("div")),i.loader=document.createElement("div"),i.loader.className="mvc-grid-loader",i.loader.appendChild(r),i.loading=setTimeout(function(){i.loader.classList.add("mvc-grid-loading")},i.loadingDelay),i.element.appendChild(i.loader));i.request=new XMLHttpRequest;i.request.open(i.requestType,i.sourceUrl+u,!0);i.request.setRequestHeader("X-Requested-With","XMLHttpRequest");i.request.onload=function(){200<=i.request.status&&i.request.status<400?n(i.request.responseText):t&&t(i.request.responseText)};i.request.onerror=t;i.request.send()},stopLoading:function(){var n=this;n.request&&n.request.readyState!=4&&n.request.abort();clearTimeout(n.loading);n.loader&&n.loader.parentElement.removeChild(n.loader)},dispatchEvent:function(n,t){var i;typeof Event=="function"?i=new CustomEvent(n,{detail:t,bubbles:!0}):(i=document.createEvent("Event"),i.initEvent(n,!0,!0),i.detail=t);this.element.dispatchEvent(i)},bind:function(){var n=this;[].forEach.call(n.element.querySelectorAll("tbody tr"),function(t){t.classList.contains("mvc-grid-empty-row")||t.addEventListener("click",function(i){var f={},r,u;n.columns.forEach(function(n,i){f[n.name]=t.cells[i].innerText});u={grid:n,data:f,originalEvent:i};typeof Event=="function"?r=new CustomEvent("rowclick",{detail:u,bubbles:!0}):(r=document.createEvent("Event"),r.initEvent("rowclick",!0,!0),r.detail=u);this.dispatchEvent(r)})})},cleanUp:function(){delete this.element.dataset.sourceUrl;delete this.element.dataset.filterMode}},n}(),MvcGridColumn=function(){function n(n,t,i){var u=this,r=t.dataset,f;u.grid=n;u.header=t;u.name=r.name;u.rowFilter=i;r.filter=="True"&&(f=t.querySelector(".mvc-grid-options"),f?f.parentElement.removeChild(f):n.filterMode=="FilterRow"&&(f=i.querySelector("select.mvc-grid-value")),u.filter={isApplied:r.filterFirstMethod!=""||r.filterSecondMethod!="",hasOptions:f&&f.children.length>0,defaultMethod:r.filterDefaultMethod,isMulti:r.filterMulti=="True",operator:r.filterOperator,name:r.filterName,options:f,first:{method:r.filterFirstMethod,value:r.filterFirstValue},second:{method:r.filterSecondMethod,value:r.filterSecondValue}});r.sort=="True"&&n.filterMode!="HeaderRow"&&(u.sort={first:r.sortFirst,order:r.sortOrder});u.bindFilter();u.bindSort();u.cleanUp()}return n.prototype={cancelFilter:function(){if(this.filter.isApplied){var n=this.grid;n.query.delete(n.prefix+"page");n.query.delete(n.prefix+"rows");n.query.deleteStartingWith(n.prefix+this.name+"-");n.reload()}else this.filter.first.value="",this.filter.second.value=""},applyFilter:function(){var t=this,n=t.grid,i=t.filter;n.query.delete(n.prefix+"page");n.query.delete(n.prefix+"rows");n.query.deleteStartingWith(n.prefix+t.name+"-");n.query.append(n.prefix+t.name+"-"+i.first.method,i.first.value);n.filterMode=="ExcelRow"&&i.isMulti&&(n.query.append(n.prefix+t.name+"-op",i.operator),n.query.append(n.prefix+t.name+"-"+i.second.method,i.second.value));n.pager&&n.pager.showPageSizes&&n.query.append(n.prefix+"rows",n.pager.rowsPerPage.value);n.reload()},applySort:function(){var t=this,n=this.grid,i;n.query.delete(n.prefix+"sort");n.query.delete(n.prefix+"order");i=t.sort.order=="asc"?"desc":"asc";!t.sort.order&&t.sort.first&&(i=t.sort.first);n.query.append(n.prefix+"sort",t.name);n.query.append(n.prefix+"order",i);n.reload()},bindFilter:function(){var n=this,r,t,i;n.filter&&(r=(n.rowFilter||n.header).querySelector(".mvc-grid-filter"),r.addEventListener("click",function(){n.filter.instance.show()}),n.filter.hasOptions?n.grid.filterMode=="FilterRow"?n.rowFilter.querySelector("select").addEventListener("change",function(){n.filter.first.value=this.value;n.filter.instance.apply()}):n.grid.filterMode=="HeaderRow"&&(t=n.rowFilter.querySelector(".mvc-grid-value"),t.readOnly=!0,t.tabIndex=-1):n.grid.filterMode!="ExcelRow"&&(i=n.rowFilter.querySelector(".mvc-grid-value"),i.addEventListener("input",function(){n.filter.first.value=this.value;n.filter.instance.validate(this)}),i.addEventListener("keyup",function(t){t.which==13&&n.filter.instance.isValid(this.value)&&n.filter.instance.apply()})))},bindSort:function(){var n=this;n.sort&&n.header.addEventListener("click",function(t){t.target.classList.contains("mvc-grid-filter")||n.applySort()})},cleanUp:function(){var n=this.header.dataset;delete n.filterDefaultMethod;delete n.filterSecondMethod;delete n.filterSecondValue;delete n.filterFirstMethod;delete n.filterFirstValue;delete n.filterOperator;delete n.filterMulti;delete n.filterName;delete n.filter;delete n.sortOrder;delete n.sortFirst;delete n.sort;delete n.name}},n}(),MvcGridPager=function(){function n(n,t){var i=this;i.grid=n;i.element=t;i.pages=t.querySelectorAll("[data-page]");i.showPageSizes=t.dataset.showPageSizes=="True";i.rowsPerPage=t.querySelector(".mvc-grid-pager-rows");i.currentPage=i.pages.length?parseInt(t.querySelector(".active").dataset.page):1;i.cleanUp();i.bind()}return n.prototype={apply:function(n){var t=this.grid;t.query.delete(t.prefix+"page");t.query.delete(t.prefix+"rows");t.query.append(t.prefix+"page",n);this.showPageSizes&&t.query.append(t.prefix+"rows",this.rowsPerPage.value);t.reload()},bind:function(){var n=this;[].forEach.call(n.pages,function(t){t.addEventListener("click",function(){n.apply(this.dataset.page)})});n.rowsPerPage.addEventListener("change",function(){n.apply(n.currentPage)})},cleanUp:function(){delete this.element.dataset.showPageSizes}},n}(),MvcGridPopup=function(){function n(n){this.element.className="mvc-grid-popup";this.grid=n;this.bind()}return n.prototype={lastActiveElement:null,element:document.createElement("div"),render:function(n){this.element.className=("mvc-grid-popup "+n.cssClasses).trim();this.element.innerHTML=n.render();this.updateValues(n.column)},updatePosition:function(n){var t=(n.rowFilter||n.header).querySelector(".mvc-grid-filter"),u=this.element.querySelector(".popup-arrow"),f=t.getBoundingClientRect(),e=this.element.clientWidth,s=window.pageYOffset+f.top+t.offsetHeight*.6+u.offsetHeight,i=window.pageXOffset+f.left-8,o=t.offsetWidth/2,r;i+e+8>window.pageXOffset+document.documentElement.clientWidth&&(r=e-t.offsetWidth-16,o+=r,i-=r);this.element.style.left=i+"px";this.element.style.top=s+"px";u.style.left=o+"px"},updateValues:function(n){var t=n.filter;this.updateValue(".mvc-grid-operator",t.operator);this.updateValue('.mvc-grid-value[data-filter="first"]',t.first.value);this.updateValue('.mvc-grid-value[data-filter="second"]',t.second.value);this.updateValue('.mvc-grid-method[data-filter="first"]',t.first.method);this.updateValue('.mvc-grid-method[data-filter="second"]',t.second.method)},updateValue:function(n,t){var i=this.element.querySelector(n);i&&(i.value=t)},show:function(t){n.prototype.lastActiveElement=document.activeElement;this.element.parentElement||document.body.appendChild(this.element);this.updatePosition(t);this.element.querySelector("input,select,textarea").focus()},hide:function(t){for(var r=t&&t.target,i;r&&!/mvc-grid-(popup|filter)/.test(r.className);)r=r.parentElement;i=n.prototype;(!r||t.which==27)&&i.element.parentNode&&(document.body.removeChild(i.element),i.lastActiveElement&&(i.lastActiveElement.focus(),i.lastActiveElement=null))},bind:function(){window.addEventListener("click",this.hide);window.addEventListener("resize",this.hide);window.addEventListener("keydown",this.hide)}},n}(),MvcGridQuery=function(){function n(n){this.query=(n||"").replace("?","")}return n.prototype={set:function(n,t){this.delete(n);this.append(n,t)},append:function(n,t){this.query+=this.query?"&":"";this.query+=encodeURIComponent(n)+"="+encodeURIComponent(t||"")},"delete":function(n){n=encodeURIComponent(n);this.query=this.query.split("&").filter(function(t){return t.split("=",1)[0]!=n}).join("&")},deleteStartingWith:function(n){n=encodeURIComponent(n);this.query=this.query.split("&").filter(function(t){return t.split("=",1)[0].indexOf(n)}).join("&")},toString:function(){return this.query?"?"+this.query:""}},n}(),MvcGridFilter=function(){function n(n){this.isMulti=n.filter.isMulti;this.mode=n.grid.filterMode;this.popup=n.grid.popup;this.cssClasses="";this.column=n;this.methods=[]}return n.prototype={init:function(){var t=this,n=t.column;n.filter.hasOptions||t.mode=="ExcelRow"||t.validate(n.rowFilter.querySelector(".mvc-grid-value"));t.methods.indexOf(n.filter.first.method)<0&&(n.filter.first.method=n.filter.defaultMethod||t.methods[0]);t.methods.indexOf(n.filter.second.method)<0&&(n.filter.second.method=n.filter.defaultMethod||t.methods[0])},show:function(){var n=this;n.popup.render(n);n.bindOperator();n.bindMethods();n.bindValues();n.bindActions();n.popup.show(n.column)},render:function(){return this.lang=this.column.grid.lang,'<div class="popup-arrow"><\/div><div class="popup-content"><div class="popup-filter">'+this.renderFilter("first")+"<\/div>"+(this.mode=="ExcelRow"&&this.isMulti?this.renderOperator()+'<div class="popup-filter">'+this.renderFilter("second")+"<\/div>":"")+this.renderActions()+"<\/div>"},renderFilter:function(n){var t=this.column.filter.hasOptions,i=this.lang[this.column.filter.name]||{};return'<div class="popup-group"><select class="mvc-grid-method" data-filter="'+n+'">'+this.methods.map(function(n){return'<option value="'+n+'">'+(i[n]||"")+"<\/option>"}).join("")+'<\/select><\/div><div class="popup-group">'+(t?'<select class="mvc-grid-value" data-filter="'+n+'">'+this.column.filter.options.innerHTML+"<\/select>":'<input class="mvc-grid-value" data-filter="'+n+'">')+"<\/div>"},renderOperator:function(){return'<div class="popup-operator"><div class="popup-group"><select class="mvc-grid-operator"><option value="">'+this.lang.operator.select+'<\/option><option value="and">'+this.lang.operator.and+'<\/option><option value="or">'+this.lang.operator.or+"<\/option><\/select><\/div><\/div>"},renderActions:function(){return'<div class="popup-actions"><button type="button" class="mvc-grid-apply" type="button">'+this.lang.filter.apply+'<\/button><button type="button" class="mvc-grid-cancel" type="button">'+this.lang.filter.remove+"<\/button><\/div>"},apply:function(){MvcGridPopup.prototype.lastActiveElement=null;this.column.applyFilter();this.popup.hide()},cancel:function(){this.column.filter.isApplied&&(MvcGridPopup.prototype.lastActiveElement=null);this.column.cancelFilter();this.popup.hide()},isValid:function(){return!0},validate:function(n){this.isValid(n.value)?n.classList.remove("invalid"):n.classList.add("invalid")},bindOperator:function(){var t=this.column.filter,n=this.popup.element.querySelector(".mvc-grid-operator");n&&n.addEventListener("change",function(){t.operator=this.value})},bindMethods:function(){var n=this.column.filter;[].forEach.call(this.popup.element.querySelectorAll(".mvc-grid-method"),function(t){t.addEventListener("change",function(){n[this.dataset.filter].method=this.value})})},bindValues:function(){var n=this;[].forEach.call(n.popup.element.querySelectorAll(".mvc-grid-value"),function(t){t.addEventListener("input",function(){if(n.column.filter[this.dataset.filter].value=this.value,n.mode!="ExcelRow"){var t=n.column.rowFilter.querySelector(".mvc-grid-value");t.value=this.tagName=="SELECT"?this.options[this.selectedIndex].text:this.value;n.validate(t)}n.validate(this)});t.addEventListener("keyup",function(t){t.which==13&&n.isValid(this.value)&&n.apply()});n.validate(t)})},bindActions:function(){var n=this.popup.element;n.querySelector(".mvc-grid-apply").addEventListener("click",this.apply.bind(this));n.querySelector(".mvc-grid-cancel").addEventListener("click",this.cancel.bind(this))}},n}(),MvcGridTextFilter=function(n){function t(t){n.call(this,t);this.methods=["contains","equals","not-equals","starts-with","ends-with"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridNumberFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","less-than","greater-than","less-than-or-equal","greater-than-or-equal"]}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^(?=.*\d+.*)[-+]?\d*[.,]?\d*$/.test(n)},t}(MvcGridFilter),MvcGridDateFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals","earlier-than","later-than","earlier-than-or-equal","later-than-or-equal"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridEnumFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter),MvcGridGuidFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"];this.cssClasses="mvc-grid-guid-filter"}return MvcGridExtends(t,n),t.prototype.isValid=function(n){return!n||/^[0-9A-F]{8}[-]?([0-9A-F]{4}[-]?){3}[0-9A-F]{12}$/i.test(n)},t}(MvcGridFilter),MvcGridBooleanFilter=function(n){function t(t){n.call(this,t);this.methods=["equals","not-equals"]}return MvcGridExtends(t,n),t}(MvcGridFilter);(function(){document.getElementById("SearchInput").addEventListener("input",function(){for(var u,f,t,e,i,r=document.querySelectorAll(".sidebar li"),o=this.value.toLowerCase().split(" "),n=0;n<r.length;n++){for(u=!0,f=r[n].innerText.toLowerCase().split(" "),t=0;t<o.length;t++){for(e=!1,i=0;i<f.length;i++)f[i].indexOf(o[t])>=0&&(e=!0);e||(u=!1)}r[n].style.display=u?"":"none"}});[].forEach.call(document.getElementsByClassName("mvc-grid"),function(n){new MvcGrid(n)})})();